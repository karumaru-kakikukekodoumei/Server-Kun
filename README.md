# AI-KUN: 自己学習型Discordボット

AI-KUNは、サーバーの会話を学習してユーザーと対話する、強化学習（正しくはファインチューニング）ベースのDiscordボットです。日本語Wikipediaで事前学習させたベースモデルを、あなたのサーバーの会話データでさらにファインチューニングすることで、サーバーの特色に合わせた対話が可能になります。

## 主な機能

-   **コマンドラインによる制御**: `research`（会話収集）、`learning`（学習）の各プロセスをコマンドラインから実行。
-   **Discordコマンドによる操作**: `!AI-KUN Run/Stop/NO`でボットの動作を制御。
-   **二段階の学習プロセス**:
    1.  **事前学習**: 日本語Wikipediaのデータで汎用的な言語能力を持つベースモデルを作成します。
    2.  **ファインチューニング**: サーバーの会話データでベースモデルをチューニングし、より自然な対話を実現します。
-   **週次の自動学習**: 稼働中に週に一度、最新の会話データを自動で収集・学習し、継続的に賢くなります。
-   **依存ライブラリの自動チェック**: 実行時に必要なPythonライブラリがインストールされているかを確認し、不足している場合は自動でインストールを試みます。

## 1. 前提条件

AI-KUNを動作させるには、お使いのWindows環境に以下がインストールされている必要があります。

-   **Python**: 3.8以上を推奨します。
-   **Juman++**: （推奨）形態素解析に使用します。インストールされていない場合、精度が低下する可能性がありますが、解析をスキップして動作します。
    -   インストール方法は[公式サイト](https://github.com/ku-nlp/jumanpp)などを参照してください。

## 2. セットアップ

### ステップ1: Discordボットの作成とトークンの取得

1.  [Discord Developer Portal](https://discord.com/developers/applications)にアクセスし、新しいアプリケーションを作成します。
2.  作成したアプリケーションの「Bot」タブに移動し、「Add Bot」をクリックしてボットを作成します。
3.  ボットの**トークン（Token）**をコピーします。これは後で使います。
4.  以下の**Privileged Gateway Intents**を**有効**にしてください。これらが無効だとボットは正しく動作しません。
    -   `PRESENCE INTENT`
    -   `SERVER MEMBERS INTENT`
    -   `MESSAGE CONTENT INTENT`

### ステップ2: .envファイルの作成

プロジェクトのルートディレクトリ（このREADME.mdがある場所）に`.env`という名前のファイルを作成し、以下の内容を記述します。

```
DISCORD_BOT_TOKEN="ここにステップ1でコピーしたボットのトークンを貼り付け"
```

### ステップ3: ボットをサーバーに招待する

1.  Developer Portalの「OAuth2」→「URL Generator」タブに移動します。
2.  **SCOPES**で`bot`を選択します。
3.  **BOT PERMISSIONS**で以下の権限を選択します。
    -   `Send Messages`
    -   `Read Message History`
    -   `View Channels`
4.  生成されたURLをコピーし、ブラウザで開いてあなたのDiscordサーバーにボットを招待します。

## 3. 使い方（推奨フロー）

コマンドプロンプトを開き、このプロジェクトのディレクトリに移動して、以下のコマンドを順番に実行してください。

### ステップ0: 依存ライブラリのインストール

最初に、以下のコマンドを実行して、必要なライブラリがすべてインストールされていることを確認します。

```shell
python src/main.py
```

不足しているライブラリがあれば、自動でインストールが開始されます。インストール後、メッセージに従って再度コマンドを実行してください。

### ステップ1: 【推奨】Wikipediaでの事前学習

より高性能なAIを作成するために、まず日本語Wikipediaでベースモデルを学習させます。**この処理はPCの性能によっては数時間〜数日かかる場合があります。**

```shell
python AI/prepare_and_train.py
```

このコマンドは、Wikipediaのデータダウンロード、テキスト整形、学習までを自動で行い、`models/wikipedia_base`に新しいベースモデルを保存します。

### ステップ2: サーバーの会話データを収集

あなたのサーバーの会話履歴を収集します。ボットが参加しているすべてのチャンネルの会話が`data`ディレクトリに保存されます。

```shell
python src/main.py research
```

### ステップ3: 会話データでのファインチューニング

収集した会話データを使って、AIモデルをあなたのサーバーに適応させます。（ステップ1を実行した場合、Wikipedia学習済みモデルが自動でベースとして使用されます。）

```shell
python src/main.py learning
```

学習が完了すると、`models/fine_tuned`に最終的なモデルが保存されます。

### ステップ4: ボットの起動

学習が完了したら、いよいよボットを起動します。

```shell
python src/main.py run
```

コンソールに「Logged in as...」と表示されれば起動成功です。

## 4. Discordコマンド

ボットが起動したら、Discordのチャンネルで以下のコマンドが使用できます。

-   `!AI-KUN Run`
    AIがこのチャンネルで応答を開始します。モデルの読み込みに少し時間がかかる場合があります。

-   `!AI-KUN Stop`
    AIの応答をすべてのチャンネルで停止します。

-   `!AI-KUN NO`
    このコマンドが実行されたチャンネルで、AIが応答しないようになります。再度有効にするには、もう一度`!AI-KUN Run`を実行してください。

---
ご不明な点があれば、お気軽にご質問ください。